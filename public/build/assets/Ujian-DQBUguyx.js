import{r as o,m as E,j as t,L as U}from"./app-DYiZyyLX.js";function T({ujian:l,questions:m,durasi:y}){let g=y;l.nama&&l.nama.toLowerCase().includes("uas")?g=90:l.nama&&l.nama.toLowerCase().includes("uts")&&(g=60);const[c,f]=o.useState(0),[i,x]=o.useState({}),[S,h]=o.useState(g*60),[u,N]=o.useState(!1),[w,p]=o.useState(null);E();const b=o.useRef(null);document.querySelector('meta[name="csrf-token"]').getAttribute("content"),o.useEffect(()=>{const e=localStorage.getItem(`ujian-${l.id}-answers`);e&&x(JSON.parse(e))},[l.id]),o.useEffect(()=>{localStorage.setItem(`ujian-${l.id}-answers`,JSON.stringify(i))},[i,l.id]),o.useEffect(()=>{const e=localStorage.getItem(`ujian-${l.id}-answers`),a=localStorage.getItem(`ujian-${l.id}-timeLeft`),r=g*60;if(!e){h(r),localStorage.setItem(`ujian-${l.id}-timeLeft`,r);return}if(a){const s=parseInt(a,10);s>0&&s<=r?h(s):(h(r),localStorage.setItem(`ujian-${l.id}-timeLeft`,r))}else h(r),localStorage.setItem(`ujian-${l.id}-timeLeft`,r)},[l.id,g]),o.useEffect(()=>(b.current=setInterval(()=>{h(e=>{if(e<=1)return clearInterval(b.current),C(),0;const a=e-1;return localStorage.setItem(`ujian-${l.id}-timeLeft`,a),a})},1e3),()=>clearInterval(b.current)),[l.id]);const C=()=>{clearInterval(b.current),localStorage.removeItem(`ujian-${l.id}-answers`),localStorage.removeItem(`ujian-${l.id}-timeLeft`),alert("Waktu habis! Jawaban Anda akan disubmit."),$()},j=(e,a)=>{const r={...i,[e]:a};console.log("Jawaban diperbarui:",r),x(r)},v=(e,a)=>{const r=i[e]||[],s=a.toUpperCase(),n=r.includes(s)?r.filter(d=>d!==s):[...r,s];x({...i,[e]:n})},$=()=>{clearInterval(b.current);const e=Object.fromEntries(Object.entries(i).map(([r,s])=>{const n=m.find(d=>d.id==r);return n?n.tipe_pertanyaan==="opsi_jawaban"?[r,[...new Set(s.map(d=>d.toUpperCase()))]]:n.tipe_pertanyaan==="pilihan_ganda"?[r,s.toUpperCase()]:n.tipe_pertanyaan==="benar_salah"?[r,s.toUpperCase()]:[r,s]:[r,s]})),a=encodeURIComponent(JSON.stringify(e));console.log("Jawaban yang dikirim:",e),localStorage.removeItem(`ujian-${l.id}-answers`),localStorage.removeItem(`ujian-${l.id}-timeLeft`),window.location.href=`/ujian/${l.id}/submit/${a}`},_=()=>{c<m.length-1&&f(c+1)},k=()=>{c>0&&f(c-1)},A=()=>{confirm("Apakah Anda yakin ingin mengakhiri ujian?")&&$()},L=e=>{const a=Math.floor(e/60),r=e%60;return`${a.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},I=e=>(console.log("gambar_soal:",e.gambar_soal),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold mb-4 whitespace-pre-line text-justify",style:{textAlign:"justify",lineHeight:"1.8"},children:e.pertanyaan}),e.gambar_soal&&t.jsx("img",{src:`/storage/${e.gambar_soal}`,alt:"Gambar Soal",className:"w-80 h-80 object-contain border border-gray-300 rounded my-2 cursor-zoom-in",onClick:()=>p(`/storage/${e.gambar_soal}`)}),e.tipe_pertanyaan==="pilihan_ganda"&&["A","B","C","D","E"].map(a=>{const r=e[`pilihan_${a.toLowerCase()}`],s=e[`pilihan_${a.toLowerCase()}_gambar`];return!r&&!s?null:t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"radio",name:`question-${e.id}`,value:a,checked:i[e.id]===a,onChange:()=>j(e.id,a)}),s?t.jsx("img",{src:`/storage/${s}`,alt:`Pilihan ${a}`,className:"w-40 h-40 object-cover border border-gray-300 rounded cursor-zoom-in",onClick:n=>{n.stopPropagation(),p(`/storage/${s}`)}}):t.jsx("span",{children:r})]})},a)}),e.tipe_pertanyaan==="opsi_jawaban"&&["A","B","C","D","E"].map(a=>{var n;const r=e[`pilihan_${a.toLowerCase()}`],s=e[`pilihan_${a.toLowerCase()}_gambar`];return!r&&!s?null:t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",name:`question-${e.id}`,value:a,checked:((n=i[e.id])==null?void 0:n.includes(a))||!1,onChange:()=>v(e.id,a)}),s?t.jsx("img",{src:`/storage/${s}`,alt:`Pilihan ${a}`,className:"w-40 h-40 object-cover border border-gray-300 rounded cursor-zoom-in",onClick:d=>{d.stopPropagation(),p(`/storage/${s}`)}}):t.jsx("span",{children:r})]})},a)}),e.tipe_pertanyaan==="benar_salah"&&["A","B"].map(a=>{const r=e[`pilihan_${a.toLowerCase()}`],s=e[`pilihan_${a.toLowerCase()}_gambar`];return!r&&!s?null:t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"radio",name:`question-${e.id}`,value:a,checked:i[e.id]===a,onChange:()=>j(e.id,a)}),s?t.jsx("img",{src:`/storage/${s}`,alt:`Pilihan ${a}`,className:"w-40 h-40 object-cover border border-gray-300 rounded cursor-zoom-in",onClick:n=>{n.stopPropagation(),p(`/storage/${s}`)}}):t.jsx("span",{children:r})]})},a)})]}));return t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 p-4",children:[t.jsx(U,{title:`Ujian: ${l.nama}`}),w&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",onClick:()=>p(null),children:t.jsx("img",{src:w,alt:"Zoomed",className:"max-w-full max-h-full rounded shadow-lg border-4 border-white",onClick:e=>e.stopPropagation()})}),t.jsxs("div",{className:"flex-1 p-4 bg-white shadow-md rounded-lg border border-gray-200",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold",children:`Soal ${c+1} dari ${m.length}`}),t.jsxs("div",{className:"text-gray-700 text-lg font-semibold",children:["Sisa Waktu: ",t.jsx("span",{className:"text-gray-900",children:L(S)})]})]}),I(m[c])]}),t.jsx("div",{className:`fixed lg:static top-0 right-0 h-full lg:h-auto bg-white shadow-lg lg:shadow-none border lg:border-none transition-transform duration-300 ${u?"translate-x-0":"translate-x-full"} lg:translate-x-0 w-64 lg:w-auto`,children:t.jsxs("div",{className:"p-4",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Nomor Soal"}),t.jsx("div",{className:"grid grid-cols-5 gap-2",children:m.map((e,a)=>{const r=i[e.id]&&i[e.id].length>0;return t.jsx("button",{className:`p-2 rounded ${c===a?"bg-blue-600 text-white":r?"bg-blue-400 text-white":"bg-gray-200 text-gray-800"}`,onClick:()=>f(a),children:a+1},a)})})]})}),t.jsx("button",{className:"lg:hidden fixed bottom-4 right-4 bg-blue-600 text-white p-3 rounded-full shadow-lg",onClick:()=>N(!u),children:u?"Tutup Soal":"Lihat Soal"}),t.jsxs("div",{className:"flex flex-row gap-2 lg:fixed lg:bottom-4 lg:right-4 mt-4 lg:mt-0",children:[t.jsx("button",{className:"px-4 py-2 bg-gray-600 text-white rounded disabled:bg-gray-300",onClick:k,disabled:c===0,children:"Sebelumnya"}),c===m.length-1?t.jsx("button",{className:"px-4 py-2 bg-red-600 text-white rounded",onClick:A,children:"Akhiri Ujian"}):t.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:_,children:"Selanjutnya"})]})]})}export{T as default};
